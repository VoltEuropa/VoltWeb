var Channel=function(){"use strict";var e=Math.floor(1000001*Math.random()),t={};function r(e){return Array.isArray?Array.isArray(e):-1!=e.constructor.toString().indexOf("Array")}var n={},o=function(e){try{var r=JSON.parse(e.data);if("object"!=typeof r||null===r)throw"malformed"}catch(e){return}var o,i,a,s=e.source,c=e.origin;if("string"==typeof r.method){var u=r.method.split("::");2==u.length?(o=u[0],a=u[1]):a=r.method}if(void 0!==r.id&&(i=r.id),"string"==typeof a){var d=!1;if(t[c]&&t[c][o])for(var l=0;l<t[c][o].length;l++)if(t[c][o][l].win===s){t[c][o][l].handler(c,a,r),d=!0;break}if(!d&&t["*"]&&t["*"][o])for(l=0;l<t["*"][o].length;l++)if(t["*"][o][l].win===s){t["*"][o][l].handler(c,a,r);break}}else void 0!==i&&n[i]&&n[i](c,a,r)};return window.addEventListener?window.addEventListener("message",o,!1):window.attachEvent&&window.attachEvent("onmessage",o),{build:function(o){var i=function(e){if(o.debugOutput&&window.console&&window.console.log){try{"string"!=typeof e&&(e=JSON.stringify(e))}catch(e){}console.log("["+c+"] "+e)}};if(!window.postMessage)throw"jschannel cannot run this browser, no postMessage";if(!window.JSON||!window.JSON.stringify||!window.JSON.parse)throw"jschannel cannot run this browser, no JSON parsing/serialization";if("object"!=typeof o)throw"Channel build invoked without a proper object argument";if(!o.window||!o.window.postMessage)throw"Channel.build() called without a valid window argument";if(window===o.window)throw"target window is same as present window -- not allowed";var a,s=!1;"string"==typeof o.origin&&("*"===o.origin?s=!0:null!==(a=o.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9_\.])+(?::\d+)?/))&&(o.origin=a[0].toLowerCase(),s=!0));if(!s)throw"Channel.build() called with an invalid origin";if(void 0!==o.scope){if("string"!=typeof o.scope)throw"scope, when specified, must be a string";if(o.scope.split("::").length>1)throw"scope may not contain double colons: '::'"}var c=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",r=0;r<5;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}(),u={},d={},l={},h=!1,f=[],p=function(e,t,a){if("function"==typeof o.gotMessageObserver)try{o.gotMessageObserver(e,a)}catch(e){i("gotMessageObserver() raised an exception: "+e.toString())}if(a.id&&t){if(u[t]){var s=function(e,t,r){var n=!1,o=!1;return{origin:t,invoke:function(t,n){if(!l[e])throw"attempting to invoke a callback of a nonexistent transaction: "+e;for(var o=!1,i=0;i<r.length;i++)if(t===r[i]){o=!0;break}if(!o)throw"request supports no such callback '"+t+"'";g({id:e,callback:t,params:n})},error:function(t,r){if(o=!0,!l[e])throw"error called for nonexistent message: "+e;delete l[e],g({id:e,error:t,message:r})},complete:function(t){if(o=!0,!l[e])throw"complete called for nonexistent message: "+e;delete l[e],g({id:e,result:t})},delayReturn:function(e){return"boolean"==typeof e&&(n=!0===e),n},completed:function(){return o}}}(a.id,e,a.callbacks?a.callbacks:[]);l[a.id]={};try{if(a.callbacks&&r(a.callbacks)&&a.callbacks.length>0)for(var c=0;c<a.callbacks.length;c++){for(var h=a.callbacks[c],f=a.params,p=h.split("/"),_=0;_<p.length-1;_++){var m=p[_];"object"!=typeof f[m]&&(f[m]={}),f=f[m]}f[p[p.length-1]]=function(){var e=h;return function(t){return s.invoke(e,t)}}()}var w=u[t](s,a.params);s.delayReturn()||s.completed()||s.complete(w)}catch(e){var v="runtime_error",y=null;if("string"==typeof e?y=e:"object"==typeof e&&(e&&r(e)&&2==e.length?(v=e[0],y=e[1]):"string"==typeof e.error&&(v=e.error,e.message?"string"==typeof e.message?y=e.message:e=e.message:y="")),null===y)try{void 0===(y=JSON.stringify(e))&&(y=e.toString())}catch(t){y=e.toString()}s.error(v,y)}}}else a.id&&a.callback?d[a.id]&&d[a.id].callbacks&&d[a.id].callbacks[a.callback]?d[a.id].callbacks[a.callback](a.params):i("ignoring invalid callback, id:"+a.id+" ("+a.callback+")"):a.id?d[a.id]?(a.error?(0,d[a.id].error)(a.error,a.message):void 0!==a.result?(0,d[a.id].success)(a.result):(0,d[a.id].success)(),delete d[a.id],delete n[a.id]):i("ignoring invalid response: "+a.id):t&&u[t]&&u[t]({origin:e},a.params)};!function(e,r,n,o){function i(t){for(var r=0;r<t.length;r++)if(t[r].win===e)return!0;return!1}var a=!1;if("*"===r){for(var s in t)if(t.hasOwnProperty(s)&&"*"!==s&&"object"==typeof t[s][n]&&(a=i(t[s][n])))break}else t["*"]&&t["*"][n]&&(a=i(t["*"][n])),!a&&t[r]&&t[r][n]&&(a=i(t[r][n]));if(a)throw"A channel is already bound to the same window which overlaps with origin '"+r+"' and has scope '"+n+"'";"object"!=typeof t[r]&&(t[r]={}),"object"!=typeof t[r][n]&&(t[r][n]=[]),t[r][n].push({win:e,handler:o})}(o.window,o.origin,"string"==typeof o.scope?o.scope:"",p);var _=function(e){return"string"==typeof o.scope&&o.scope.length&&(e=[o.scope,e].join("::")),e},g=function(e,t){if(!e)throw"postMessage called with null message";if(i((h?"post  ":"queue ")+" message: "+JSON.stringify(e)),t||h){if("function"==typeof o.postMessageObserver)try{o.postMessageObserver(o.origin,e)}catch(e){i("postMessageObserver() raised an exception: "+e.toString())}o.window.postMessage(JSON.stringify(e),o.origin)}else f.push(e)},m={unbind:function(e){if(u[e]){if(!delete u[e])throw"can't delete method: "+e;return!0}return!1},bind:function(e,t){if(!e||"string"!=typeof e)throw"'method' argument to bind must be string";if(!t||"function"!=typeof t)throw"callback missing from bind params";if(u[e])throw"method '"+e+"' is already bound!";return u[e]=t,this},call:function(t){if(!t)throw"missing arguments to call function";if(!t.method||"string"!=typeof t.method)throw"'method' argument to call must be string";if(!t.success||"function"!=typeof t.success)throw"'success' callback missing from call";var r={},o=[],i=function(e,t){if("object"==typeof t)for(var n in t)if(t.hasOwnProperty(n)){var a=e+(e.length?"/":"")+n;"function"==typeof t[n]?(r[a]=t[n],o.push(a),delete t[n]):"object"==typeof t[n]&&i(a,t[n])}};i("",t.params);var a,s,c,u={id:e,method:_(t.method),params:t.params};o.length&&(u.callbacks=o),t.timeout&&(a=e,s=t.timeout,c=_(t.method),window.setTimeout(function(){if(d[a]){var e="timeout ("+s+"ms) exceeded on method '"+c+"'";(0,d[a].error)("timeout_error",e),delete d[a],delete n[a]}},s)),d[e]={callbacks:r,error:t.error,success:t.success},n[e]=p,e++,g(u)},notify:function(e){if(!e)throw"missing arguments to notify function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to notify must be string";g({method:_(e.method),params:e.params})},destroy:function(){!function(e,r,n){for(var o=t[r][n],i=0;i<o.length;i++)o[i].win===e&&o.splice(i,1);0===t[r][n].length&&delete t[r][n]}(o.window,o.origin,"string"==typeof o.scope?o.scope:""),window.removeEventListener?window.removeEventListener("message",p,!1):window.detachEvent&&window.detachEvent("onmessage",p),h=!1,u={},l={},d={},o.origin=null,f=[],i("channel destroyed"),c=""}};return m.bind("__ready",function(e,t){if(i("ready msg received"),h)throw"received ready message while in ready state.  help!";for(c+="ping"===t?"-R":"-L",m.unbind("__ready"),h=!0,i("ready msg accepted."),"ping"===t&&m.notify({method:"__ready",params:"pong"});f.length;)g(f.pop());"function"==typeof o.onReady&&o.onReady(m)}),setTimeout(function(){g({method:_("__ready"),params:"ping"},!0)},0),m}}}();
/*! @source https://gist.github.com/1129031 */
!function(e){"use strict";var t=e.prototype,r=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){var n,o,i,a;return/^\s*text\/html\s*(?:;|$)/i.test(t)?((i=(o=document.implementation.createHTMLDocument("")).documentElement).innerHTML=e,a=i.firstElementChild,1===i.childElementCount&&"html"===a.localName.toLowerCase()&&o.replaceChild(a,i),n=o):n=r.apply(this,arguments),n}}(DOMParser),"function"!=typeof document.contains&&(Document.prototype.contains=function(e){return e===this||e.parentNode===this||this.documentElement.contains(e)}),function(e){"use strict";try{if("https://example.com/a"===new window.URL("../a","https://example.com/").href)return}catch(e){}var t=/^(?:[a-z]+:)?\/\/|data:/i;function r(r,n){if(void 0!==n){if(!t.test(n))throw new TypeError("Failed to construct 'URL': Invalid base URL");r=function(t,r){var n,o,i;return t&&r?(o=(n=(new e).parseFromString("<!doctype><html><head></head></html>","text/html")).createElement("base"),i=n.createElement("link"),n.head.appendChild(o),n.head.appendChild(i),o.href=r,i.href=t,i.href):t}(r,n)}if(!t.test(r))throw new TypeError("Failed to construct 'URL': Invalid URL");this.href=r}r.prototype.href="",window.URL&&window.URL.createObjectURL&&(r.createObjectURL=window.URL.createObjectURL),window.URL&&window.URL.revokeObjectURL&&(r.revokeObjectURL=window.URL.revokeObjectURL),window.URL=r}(DOMParser),function(e,t,r,n,o,i,a,s,c,u,d,l){"use strict";function h(e){if(this.name="scopeerror",void 0!==e&&"string"!=typeof e)throw new TypeError("You must pass a string.");this.message=e||"Scope Error"}function f(e,t,n){var o;try{o=e.apply(n,t)}catch(e){return(new r.Queue).push(function(){return r.reject(e)})}return o instanceof r.Queue?o:(new r.Queue).push(function(){return o})}function p(e){var t;return new r.Promise(function(r,n){(t=new XMLHttpRequest).open("GET",e),t.onreadystatechange=function(){try{0===t.readyState?n(t):4===t.readyState&&(t.status<200||t.status>=300||!/^text\/html[;]?/.test(t.getResponseHeader("Content-Type")||"")?n(t):r(t))}catch(e){n(e)}},t.setRequestHeader("Accept","text/html"),t.withCredentials=!0,t.send()},function(){void 0!==t&&t.readyState!==t.DONE&&t.abort()})}h.prototype=new Error,h.prototype.constructor=h;var _,g,m,w,v,y,b={},E={},S={},L=[],q=0,C=new RegExp("^(?:[a-z]+:)?//|data:","i"),O=!1,M=[];function R(r){var n,o,i,a,s,c;if(O)return console.info("-- Error dropped, as page is unloaded"),void console.info(r);for(M.push(r),M.push(new Error("stopping renderJS")),o=e.getElementsByTagName("body")[0];o.firstChild;)o.removeChild(o.firstChild);for(i=e.createElement("section"),(a=e.createElement("h1")).textContent="Unhandled Error",i.appendChild(a),(a=e.createElement("p")).textContent="Please report this error to the support team",i.appendChild(a),(a=e.createElement("p")).textContent="Location: ",(s=e.createElement("a")).href=s.textContent=t.location.toString(),a.appendChild(s),i.appendChild(a),(a=e.createElement("p")).textContent="User-agent: "+u.userAgent,i.appendChild(a),(a=e.createElement("p")).textContent="Date: "+new Date(Date.now()).toISOString(),i.appendChild(a),o.appendChild(i),n=0;n<M.length;n+=1){if((c=M[n])instanceof d&&void 0!==(c={string:c.toString(),message:c.message,type:c.type,target:c.target}).target&&M.splice(n+1,0,c.target),c instanceof XMLHttpRequest&&(c={message:c.toString(),readyState:c.readyState,status:c.status,statusText:c.statusText,response:c.response,responseUrl:c.responseUrl,response_headers:c.getAllResponseHeaders()}),c.constructor===Array||c.constructor===String||c.constructor===Object)try{c=JSON.stringify(c)}catch(e){}i=e.createElement("section"),(a=e.createElement("h2")).textContent=c.message||c,i.appendChild(a),void 0!==c.fileName&&((a=e.createElement("p")).textContent="File: "+c.fileName+": "+c.lineNumber,i.appendChild(a)),void 0!==c.stack&&((a=e.createElement("pre")).textContent="Stack: "+c.stack,i.appendChild(a)),o.appendChild(i)}console.error(r.stack),console.error(r)}function A(e){if(this.name="resolved",void 0!==e&&"string"!=typeof e)throw new TypeError("You must pass a string.");this.message=e||"Default Message"}function j(){if(!(this instanceof j))return new j}function x(e){e.hasOwnProperty("__monitor")&&(e.__monitor.cancel(),delete e.__monitor,e.__job_list=[])}function P(e){e.__sub_gadget_dict={},e.__job_list=[],void 0!==e.__json_state&&(e.state=JSON.parse(e.__json_state))}function k(){var e,t,n,o,i,a=this.element.querySelectorAll("[data-gadget-url]"),s=[],c=this;function u(e){return function(t){var r=c.__acquired_method_dict||{};if(r.hasOwnProperty("reportGadgetDeclarationError"))return r.reportGadgetDeclarationError.apply(c,[arguments,e]);throw t}}for(i=0;i<a.length;i+=1)t=(e=a[i]).getAttribute("data-gadget-scope"),n=e.getAttribute("data-gadget-url"),o=e.getAttribute("data-gadget-sandbox"),null!==n&&s.push(c.declareGadget(n,{element:e,scope:t||void 0,sandbox:o||void 0}).push(void 0,u(t)));return r.all(s)}function N(e,t,n,o){var i=f(n,o,e);e.__job_dict.hasOwnProperty(t)&&e.__job_dict[t].cancel(),e.__job_dict[t]=i,e.__monitor.monitor((new r.Queue).push(function(){return i}).push(void 0,function(e){if(!(e instanceof r.CancellationError))throw e}))}function T(e){var t;0===e.constructor.__service_list.length&&!e.constructor.__job_declared||e.hasOwnProperty("__monitor")||((t=e).__monitor=new g,t.__job_dict={},t.__job_triggered=!1,t.__monitor.fail(function(e){if(!(e instanceof r.CancellationError))return t.aq_reportServiceError(e)}).fail(R),e.__monitor.monitor((new r.Queue).push(function(){var t,r=e.constructor.__service_list,n=e.__job_list;for(t=0;t<r.length;t+=1)e.__monitor.monitor(r[t].apply(e));for(t=0;t<n.length;t+=1)N(e,n[t][0],n[t][1],n[t][2]);e.__job_list=[],e.__job_triggered=!0})))}function J(e,t,r){e.hasOwnProperty("__method_type_dict")||(e.__method_type_dict={}),e.__method_type_dict[t]=r}function U(e,t){e.__aq_parent=function(r,n){return function(e,t,r){var n,o,i=this,a=i.__acquired_method_dict||{};if(!a.hasOwnProperty(t))return i.__aq_parent(t,r);for(n in i.__sub_gadget_dict)i.__sub_gadget_dict.hasOwnProperty(n)&&i.__sub_gadget_dict[n]===e&&(o=n);return f(a[t],[r,o],i).push(void 0,function(e){if(e instanceof _.AcquisitionError)return i.__aq_parent(t,r);throw e})}.apply(t,[e,r,n])}}function D(){if(!(this instanceof D))return new D;j.call(this)}function G(t,r,n,o){var i,a,s=t.__template_element.body.childNodes,c=e.createDocumentFragment();for((a=new t).element=r.element,a.state={},i=0;i<s.length;i+=1)c.appendChild(s[i].cloneNode(!0));return a.element.appendChild(c),U(a,n),P(a),void 0!==o&&o.parentNode.replaceChild(r.element,o),a}function F(e,t,r,n){var o=_.declareGadgetKlass(e);return"function"==typeof o.then?o.then(function(e){return G(e,t,r,n)}):G(o,t,r,n)}function Q(){if(!(this instanceof Q))return new Q;j.call(this)}function H(t,n,i,a){var s,c,u=r.defer();if(void 0===a)throw new Error("DOM element is required to create Iframe Gadget "+t);if(!e.contains(a))throw new Error("The parent element is not attached to the DOM for "+t);return U(s=new Q,i),(c=e.createElement("iframe")).addEventListener("error",function(e){u.reject(e)}),c.addEventListener("load",function(){return r.timeout(5e3).fail(function(){u.reject(new Error("Timeout while loading: "+t))})}),c.setAttribute("src",t),s.__path=t,s.element=n.element,s.state={},n.element.appendChild(c),P(s),a.parentNode.replaceChild(n.element,a),s.__chan=o.build({window:c.contentWindow,origin:"*",scope:"renderJS"}),s.__chan.bind("declareMethod",function(e,t){return s[t]=function(){var e=arguments,n=new r.Promise(function(r,n){s.__chan.call({method:"methodCall",params:[t,Array.prototype.slice.call(e,0)],success:r,error:n})});return f(function(){return n})},"OK"}),s.__chan.bind("ready",function(e){return u.resolve(s),"OK"}),s.__chan.bind("failed",function(e,t){return u.reject(t),"OK"}),s.__chan.bind("acquire",function(e,t){(new r.Queue).push(function(){return s.__aq_parent.apply(s,t)}).then(e.complete).fail(function(t){e.error(t.toString())}),e.delayReturn(!0)}),u.promise}function I(e,t,o,i){return(new r.Queue).push(function(){return p(e)}).push(function(t){var o=(new n).parseFromString(t.responseText,"text/html"),i=o.createElement("base");return i.href=e,o.head.insertBefore(i,o.head.firstChild),function(e){var t=new s;return new r.Promise(function(r,n){t.addEventListener("load",function(e){r(e.target.result)}),t.addEventListener("error",n),t.readAsDataURL(e)},function(){t.abort()})}(new c([o.documentElement.outerHTML],{type:"text/html;charset=UTF-8"}))}).push(function(e){return H(e,t,o,i)})}function K(t,n,o,i,a,s){var c,u;function d(e){return function(){return e.call(t,t)}}function l(){return t.element._gadget=t,o.__sub_gadget_dict[s]=t,e.contains(t.element)&&T(t),t}if(t.constructor.__ready_list.length){for(u=new r.Queue,c=0;c<t.constructor.__ready_list.length;c+=1)u.push(d(t.constructor.__ready_list[c]));return u.push(l),u}return l()}function z(e){var n,i,a,s,c,u,d,l,h;if(b.hasOwnProperty(e))throw new Error("bootstrap should not be called twice");return(n=D).__ready_list=[],n.__service_list=j.__service_list.slice(),n.prototype.__path=e,U(i=new n,((h=new j).__acquired_method_dict={reportServiceError:function(e){R(e[0])}},h.__aq_parent=function(e){throw new _.AcquisitionError("No gadget provides "+e)},h)),s=function(e){c.push(e)},l=[n,i,a,c=["getInterfaceList","getRequiredCSSList","getRequiredJSList","getPath","getTitle","getMethodList"]],t.self===t.top?u=l:(d=r.defer(),u=r.any([d.promise,(new r.Queue).push(function(){return r.delay(1e3)}).push(function(){return l[2]=void 0,l})]),a=o.build({window:t.parent,origin:"*",scope:"renderJS",onReady:function(){var e,t;for(s=function(e){c.push(new r.Promise(function(t,r){a.call({method:"declareMethod",params:e,success:t,error:r})}))},t=c.length,e=0;e<t;e+=1)s(c[e]);d.resolve(l)}}),l[2]=a),n.declareMethod=function(e,t,r){var n=j.declareMethod.apply(this,[e,t,r]);return s(e),n},n.declareService=j.declareService,n.declareJob=j.declareJob,n.onEvent=j.onEvent,n.onLoop=j.onLoop,n.declareAcquiredMethod=j.declareAcquiredMethod,n.allowPublicAcquisition=j.allowPublicAcquisition,n.prototype.__acquired_method_dict={},L.push(n),u}t.addEventListener("error",function(e){M.push(e)}),t.addEventListener("beforeunload",function(){O=!0}),(m=function(){if(!(this instanceof m))return new m;this._latest_promise=null}).prototype={constructor:m,lockAndRun:function(e){var t=this._latest_promise;return this._latest_promise=null===t?r.resolve(e()):this._latest_promise.always(function(){return e()}),this._latest_promise}},A.prototype=new Error,A.prototype.constructor=A,(g=function(){var e,t,n,o=this,i=[];if(!(this instanceof g))return new g;function a(){var e,t=i.length;for(e=0;e<t;e+=1)i[e].cancel();i=[]}e=new r.Promise(function(e,r){t=function(e){if(!n)return o.isRejected=!0,o.rejectedReason=e,n=!0,a(),r(e)}},a),o.cancel=function(){n||(n=!0,e.cancel(),e.fail(function(e){o.isRejected=!0,o.rejectedReason=e}))},o.then=e.then.bind(e),o.fail=e.fail.bind(e),o.monitor=function(e){if(n)throw new A;var o=(new r.Queue).push(function(){return e}).push(function(e){var t,r,n=i.length,o=[];for(r=0;r<n;r+=1)(t=i[r]).isFulfilled||t.isRejected||o.push(t);i=o},function(n){throw n instanceof r.CancellationError&&(e.isFulfilled&&e.isRejected||e.cancel()),t(n),n});return i.push(o),this}}).prototype=Object.create(r.Promise.prototype),g.prototype.constructor=g,j.prototype.__title="",j.prototype.__interface_list=[],j.prototype.__path="",j.prototype.__html="",j.prototype.__required_css_list=[],j.prototype.__required_js_list=[],j.__ready_list=[],j.ready=function(e){return this.__ready_list.push(e),this},j.setState=function(e){return this.prototype.__json_state=JSON.stringify(e),this},j.onStateChange=function(e){return this.prototype.__state_change_callback=e,this},j.__service_list=[],j.declareService=function(e){return this.__service_list.push(e),this},j.onEvent=function(e,t,n,o){return this.__service_list.push(function(){return function(e,t,n,o,i){var a,s;function c(){void 0!==s&&"function"==typeof s.cancel&&s.cancel()}function u(){void 0!==a&&e.removeEventListener(t,a,n),c()}return void 0===i&&(i=!0),new r.Promise(function(d,l){var h;a=function(e){i&&(e.stopPropagation(),e.preventDefault()),c();try{h=o(e)}catch(e){h=r.reject(e)}s=h,(new r.Queue).push(function(){return h}).push(void 0,function(e){e instanceof r.CancellationError||(u(),l(e))})},e.addEventListener(t,a,n)},u)}(this.element,e,n,t.bind(this),o)}),this},j.onLoop=function(e,n){return void 0===n&&(n=0),this.__service_list.push(function(){var o=new r.Queue,i=this,a=function(){o.push(function(){return r.delay(n)}).push(function(){return new r.Promise(function(r){e=t.requestAnimationFrame(r)},function(){t.cancelAnimationFrame(e)});var e}).push(function(){return e.apply(i,[])}).push(a)};return a(),o}),this},j.declareJob=function(e,t){return this.__job_declared=!0,this.prototype[e]=function(){var r=arguments;this.__job_triggered?N(this,e,t,r):this.__job_list.push([e,t,r])},J(this,e,"job"),this},j.declareMethod=function(e,t,r){return this.prototype[e]=function(){var e,n=this,o=arguments;return void 0!==r&&r.hasOwnProperty("mutex")?(e="__mutex_"+r.mutex,n.hasOwnProperty(e)||(n[e]=new m),f(n[e].lockAndRun,[function(){return t.apply(n,o)}],n[e])):f(t,o,n)},J(this,e,"method"),this},j.declareMethod("getInterfaceList",function(){return this.__interface_list}).declareMethod("getMethodList",function(e){var t,r=[],n=this.constructor.__method_type_dict||{};for(t in n)n.hasOwnProperty(t)&&(void 0!==e&&e!==n[t]||r.push(t));return r}).declareMethod("getRequiredCSSList",function(){return this.__required_css_list}).declareMethod("getRequiredJSList",function(){return this.__required_js_list}).declareMethod("getPath",function(){return this.__path}).declareMethod("getTitle",function(){return this.__title}).declareMethod("getElement",function(){if(void 0===this.element)throw new Error("No element defined");return this.element}).declareMethod("changeState",function(e){var t,r,n=this,o=!1,i=n.hasOwnProperty("__modification_dict");for(t in i?(r=n.__modification_dict,o=!0):r={},e)e.hasOwnProperty(t)&&e[t]!==n.state[t]&&(n.state[t]=e[t],r[t]=e[t],o=!0);if(o&&void 0!==n.__state_change_callback)return n.__modification_dict=r,f(n.__state_change_callback,[r],n).push(function(e){return delete n.__modification_dict,e})},{mutex:"changestate"}),j.declareAcquiredMethod=function(e,t){return this.prototype[e]=function(){var e=Array.prototype.slice.call(arguments,0);return f(this.__aq_parent,[t,e],this)},J(this,e,"acquired_method"),this},j.declareAcquiredMethod("aq_reportServiceError","reportServiceError"),j.declareAcquiredMethod("aq_reportGadgetDeclarationError","reportGadgetDeclarationError"),j.allowPublicAcquisition=function(e,t){return this.prototype.__acquired_method_dict[e]=t,this},D.__ready_list=[],D.__service_list=j.__service_list.slice(),D.ready=j.ready,D.setState=j.setState,D.onStateChange=j.onStateChange,D.declareService=j.declareService,D.onEvent=j.onEvent,D.onLoop=j.onLoop,D.prototype=new j,D.prototype.constructor=D,Q.__ready_list=[],Q.ready=j.ready,Q.setState=j.setState,Q.onStateChange=j.onStateChange,Q.__service_list=[],Q.declareService=j.declareService,Q.onEvent=j.onEvent,Q.onLoop=j.onLoop,Q.prototype=new j,Q.prototype.constructor=Q,j.declareMethod("declareGadget",function(t,n){var o,i,a,s,c=this;if(void 0===n&&(n={}),void 0===n.sandbox&&(n.sandbox="public"),void 0===n.element)n.element=e.createElement("div");else if("string"==typeof n.element)n.element=e.createElement(n.element);else{if(!n.element.parentNode)throw new Error("No need to manually provide a DOM element without a parentNode: "+t);s=n.element,n.element=s.cloneNode(!1)}if(t=_.getAbsoluteURL(t,this.__path),void 0===(a=n.scope))for(a="RJS_"+q,q+=1;c.__sub_gadget_dict.hasOwnProperty(a);)a="RJS_"+q,q+=1;if(n.element.setAttribute("data-gadget-scope",a),n.element.setAttribute("data-gadget-url",t),n.element.setAttribute("data-gadget-sandbox",n.sandbox),"public"===n.sandbox)o=F;else if("iframe"===n.sandbox)o=H;else{if("dataurl"!==n.sandbox)throw new Error("Unsupported sandbox options '"+n.sandbox+"'");o=I}return"function"==typeof(i=o(t,n,c,s)).then?(new r.Queue).push(function(){return i}).push(function(e){return K(e,0,c,0,0,a)}):K(i,0,c,0,0,a)}).declareMethod("getDeclaredGadget",function(e){if(!this.__sub_gadget_dict.hasOwnProperty(e))throw new h("Gadget scope '"+e+"' is not known.");return this.__sub_gadget_dict[e]}).declareMethod("dropGadget",function(e){if(!this.__sub_gadget_dict.hasOwnProperty(e))throw new h("Gadget scope '"+e+"' is not known.");delete this.__sub_gadget_dict[e]}),(_=function(e){var r;if(e===t&&(r=L[0]),void 0===r)throw new Error("Unknown selector '"+e+"'");return r}).AcquisitionError=function(e){if(this.name="AcquisitionError",void 0!==e&&"string"!=typeof e)throw new TypeError("You must pass a string.");this.message=e||"Acquisition failed"},_.AcquisitionError.prototype=new Error,_.AcquisitionError.prototype.constructor=_.AcquisitionError,_.getAbsoluteURL=function(e,t){return t&&e?new l(e,t).href:e},_.declareJS=function(t,n,o){var i;return E.hasOwnProperty(t)?i=r.resolve():(E[t]=null,i=new r.Promise(function(r,i){var a;(a=e.createElement("script")).async=!1,a.type="text/javascript",a.onload=function(){!0===o&&L.shift(),r()},a.onerror=function(e){!0===o&&L.shift(),i(e)},a.src=t,n.appendChild(a)})),i},_.declareCSS=function(t,n){return S.hasOwnProperty(t)?r.resolve():new r.Promise(function(r,o){var i;(i=e.createElement("link")).rel="stylesheet",i.type="text/css",i.href=t,i.onload=function(){S[t]=null,r()},i.onerror=o,n.appendChild(i)})},_.declareGadgetKlass=function(t){var o,i;if(b.hasOwnProperty(t)){if(b[t].hasOwnProperty("defer_list"))return i=r.defer(),b[t].defer_list.push(i),i.promise;if(b[t].is_resolved)return b[t].result;throw b[t].result}return b[t]={defer_list:[]},(new r.Queue).push(function(){return p(t)}).push(function(i){o=function(e,t){var r,o,i;for(o in(r=function(){j.call(this)}).__ready_list=[],r.__service_list=j.__service_list.slice(),r.declareMethod=j.declareMethod,r.declareJob=j.declareJob,r.declareAcquiredMethod=j.declareAcquiredMethod,r.allowPublicAcquisition=j.allowPublicAcquisition,r.ready=j.ready,r.setState=j.setState,r.onStateChange=j.onStateChange,r.declareService=j.declareService,r.onEvent=j.onEvent,r.onLoop=j.onLoop,(r.prototype=new j).constructor=r,r.prototype.__path=t,r.prototype.__acquired_method_dict={},r.__template_element=(new n).parseFromString(e.responseText,"text/html"),i=_.parseGadgetHTMLDocument(r.__template_element,t))i.hasOwnProperty(o)&&(r.prototype["__"+o]=i[o]);return r.__template_element.querySelectorAll("[data-gadget-url]").length&&r.__ready_list.push(k),r}(i,t);var a,s=e.createDocumentFragment(),c=[],u=o.prototype.__required_js_list,d=o.prototype.__required_css_list;if(u.length){for(L.push(o),a=0;a<u.length-1;a+=1)c.push(_.declareJS(u[a],s));c.push(_.declareJS(u[a],s,!0))}for(a=0;a<d.length;a+=1)c.push(_.declareCSS(d[a],s));return e.head.appendChild(s),r.all(c)}).push(function(){var e,r=b[t].defer_list.length;for(e=0;e<r;e+=1)b[t].defer_list[e].resolve(o);return delete b[t].defer_list,b[t].result=o,b[t].is_resolved=!0,o}).push(void 0,function(e){var r,n=b[t].defer_list.length;for(r=0;r<n;r+=1)b[t].defer_list[r].reject(e);throw delete b[t].defer_list,b[t].result=e,b[t].is_resolved=!1,e})},_.clearGadgetKlassList=function(){b={},E={},S={}},_.parseGadgetHTMLDocument=function(e,t){var r,n,o={title:"",interface_list:[],required_css_list:[],required_js_list:[]};if(!t||!C.test(t))throw new Error("The url should be absolute: "+t);if(9!==e.nodeType)throw new Error("The first parameter should be an HTMLDocument");if(o.title=e.title,null!==e.head)for(r=0;r<e.head.children.length;r+=1)null!==(n=e.head.children[r]).href&&("stylesheet"===n.rel?o.required_css_list.push(_.getAbsoluteURL(n.getAttribute("href"),t)):"SCRIPT"!==n.nodeName||"text/javascript"!==n.type&&n.type?"http://www.renderjs.org/rel/interface"===n.rel&&o.interface_list.push(_.getAbsoluteURL(n.getAttribute("href"),t)):o.required_js_list.push(_.getAbsoluteURL(n.getAttribute("src"),t)));return o},_.Mutex=m,_.ScopeError=h,t.rJS=t.renderJS=_,t.__RenderJSGadget=j,t.__RenderJSEmbeddedGadget=D,t.__RenderJSIframeGadget=Q,w=new r.defer,_.manualBootstrap=function(){w.resolve()},e.addEventListener("DOMContentLoaded",w.resolve,!1),function(t){var n,o,s,c,u=z(t);(new r.Queue).push(function(){return u}).push(function(e){return n=e[0],o=e[1],s=e[2],c=e[3],w.promise}).push(function(){return r.all(c)}).push(function(c){return void 0!==s&&function(e,t,n){t.__aq_parent=e.prototype.__aq_parent=function(e,t,o){return new r.Promise(function(r,i){n.call({method:"acquire",params:[e,t],success:r,error:i,timeout:o})})},n.bind("methodCall",function(e,r){t[r[0]].apply(t,r[1]).push(e.complete,function(t){e.error(t.toString())}),e.delayReturn(!0)})}(n,o,s),function(t,n,o){var s,c,u=_.parseGadgetHTMLDocument(e,n),d=e.createDocumentFragment();for(c in u)u.hasOwnProperty(c)&&(t.prototype["__"+c]=u[c]);for(t.__template_element=e.createElement("div"),o.element=e.body,o.state={},s=0;s<o.element.childNodes.length;s+=1)d.appendChild(o.element.childNodes[s].cloneNode(!0));return t.__template_element.appendChild(d),r.all([o.getRequiredJSList(),o.getRequiredCSSList()]).then(function(e){var t,r=e[0],n=e[1];for(t=0;t<r.length;t+=1)E[r[t]]=null;for(t=0;t<n.length;t+=1)S[n[t]]=null;L.shift()}).then(function(){var t=e.querySelector("body");return new i(function(t){var r,n,o,i,s,c;t.forEach(function(t){if("childList"===t.type){for(o=t.removedNodes.length,r=0;r<o;r+=1)if((s=t.removedNodes[r]).nodeType===a.ELEMENT_NODE)for(s.hasAttribute("data-gadget-url")&&void 0!==s._gadget&&x(s._gadget),c=s.querySelectorAll("[data-gadget-url]"),i=c.length,n=0;n<i;n+=1)void 0!==(s=c[n])._gadget&&x(s._gadget);for(o=t.addedNodes.length,r=0;r<o;r+=1)if((s=t.addedNodes[r]).nodeType===a.ELEMENT_NODE)for(s.hasAttribute("data-gadget-url")&&void 0!==s._gadget&&e.contains(s)&&T(s._gadget),c=s.querySelectorAll("[data-gadget-url]"),i=c.length,n=0;n<i;n+=1)s=c[n],e.contains(s)&&void 0!==s._gadget&&T(s._gadget)}})}).observe(t,{childList:!0,subtree:!0,attributes:!1,characterData:!1}),o})}(n,t,o)}).push(function(){return P(o),n.__ready_list.unshift(k),function(e,t){var n,o=new r.Queue;function i(e){return function(){return e.call(t,t)}}for(e.ready(function(){return T(t)}),n=0;n<e.__ready_list.length;n+=1)o.push(i(e.__ready_list[n]));return o}(n,o)}).push(function(){void 0!==s&&s.notify({method:"ready"})}).push(void 0,function(e){throw R(e),void 0!==s&&s.notify({method:"failed",params:e.toString()}),e})}((v=t.location.href,(y=v.indexOf("#"))>0&&(v=v.substring(0,y)),v))}(document,window,RSVP,DOMParser,Channel,MutationObserver,Node,FileReader,Blob,navigator,Event,URL);